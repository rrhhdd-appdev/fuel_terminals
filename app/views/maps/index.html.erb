<h1>Homepage?</h1>





<div>
  <div class="map" id="map" style='height: 700px;'></div>
</div>

<script>
  function initMap() {
    // initiate a new map
   var mapDiv = document.getElementById('map');
   var map = new google.maps.Map(mapDiv);


    // An empty bounds variable for seeting automatic zoom level (bounds of map)
    var bounds = new google.maps.LatLngBounds();

    <% Facility.all.each do |place| %>

      // Make info window for this place
      var infowindow_<%= place.id %> = new google.maps.InfoWindow({
        content: "<b><%= place.name %></b>" 
      });

      // Make marker for this place
        var marker_<%= place.id %> = new google.maps.Marker({
          position: {lat: <%= place.latitude %>, lng: <%= place.longitude %>},
          map: map,
          title: "<%= place.name %>",
          icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
        });

      // Click to show info window
      marker_<%= place.id %>.addListener('click', function() {
        infowindow_<%= place.id %>.open(map, marker_<%= place.id %>);
      });

      // Add this marker in map bounds
      bounds.extend(new google.maps.LatLng(<%= place.latitude %>, <%= place.longitude %>));
      
    <% end %>

    map.fitBounds(bounds);
  };
</script>



<script src="https://maps.googleapis.com/maps/api/js?key=<%=ENV.fetch("GMAPS_KEY")%>&callback=initMap"
async defer></script>



<!-- <h1><%=Facility.count%></h1> -->
<!-- <h1><%=Facility.where({ :state => "CA" }).count%></h1> --> 




<!--Form to search for facilities that match a certain criteria -->

<h1>Terminal Search
<div>
  
</div>


<form action="/search_market" method="post">
  <label for="state_search" class="form-label">State</label>
  <select class="form-select" aria-label="Default select example" id="state_search" name="query_state">
    <option selected>State</option>
    <% @state_list.each do |list|%>
      <option value="<%=list%>"><%=list%></option>
    <%end%>
  </select>
  <button type="submit" class="btn btn-primary">Sign in</button>
</form>

<!--
<form action="/search_market" method="post">
      <div>
        <label for="state_box">
          State
        </label>

        <input type="text" id="state_box" name="query_state">
      </div>
  </form>
-->

<style>
  .map{
    margin-bottom: 20px;
    border-radius: 10px;
  }
  
</style>


<%@search_criteria = %q(CA)%>
<%= Facility.all.where({ :state => @search_criteria })%>
